function generateDropboxAccount() {
    var phantom = require('phantom'),
        dropboxAddress = "http://dropbox.com",
        maildropAddress = "http://maildrop.cc",
        EMAIL,
        PASSWORD = 'dummy_password',
        account = {"email": 'TMP',
                   "password": PASSWORD};

    phantom.create(function(ph) {
        ph.createPage(function(maildropPage) {
            maildropPage.open(maildropAddress, function(status) {
                if (status == 'success') {
                    maildropPage.includeJs("http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js", function() {
                        maildropPage.evaluate((function() {
                            return $('#suggestion a').html();
                        }), function(result) {
                            EMAIL = result;
                            console.log('Email found is: ' + EMAIL);
                            ph.createPage(function(dropboxPage) {
                                dropboxPage.open(dropboxAddress, function(dstatus) {
                                    if (dstatus == 'success') {
                                        dropboxPage.evaluate(function(EMAIL, PASSWORD) {
                                            document.getElementById("fname").value = "dummy_fname";
                                            document.getElementById("lname").value = "dummy_lname";
                                            document.getElementById("email").value = EMAIL;
                                            document.getElementById("password").value = PASSWORD;
                                            document.getElementById("tos_agree").checked = true;
                                            //document.getElementById("signup-form").submit();
                                            return EMAIL;
                                        }, function(dresult) {
                                            console.log(dresult);
                                            //console.log(account['email']);
                                            account['email'] = dresult;
                                        }, EMAIL, PASSWORD);
                                    }
                                });
                            // account = result;
                            // return result;
                            });
                        });
                    });
                }
            });
        });
    });
    //while (account['email'] == null){
    //    console.log(account);
    //}
    setInterval(function() { if(account['email'] != 'TMP') {
        console.log(account);
    }}, 1000);
    // time = new Date().getTime() + 10000;
    // while (time > new Date().getTime());
    // return account;
    
}

module.exports = generateDropboxAccount;